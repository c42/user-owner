<%= stylesheet_link_tag 'admin_page' %>
<div id="admin">
  <p>
    <%= t(".no_organizations") if @organizations.empty? %>
  </p>

  <% unless @organizations.empty? %>
    <h1><%= t ".list_of_organizations" %></h1>
    <table>
      <h2><%= t ".pending" %></h2>
      <% @organizations.select{ |org| org.status == "pending"}.each do |organization|%>
        <tr>
          <td> <%= organization.name %> </td>
          <td>

            <%= form_tag organization_reject_path(organization.id), :method => :put do %>
              <%= hidden_field_tag 'rejection_message' %>
              <div class="actions">
                <%= hidden_field_tag t(".reject")%>
              </div>
            <% end %>

            <div id="action_links">
              <%= link_to t('.approve'), organization_approve_path(organization.id), :method => :put, :confirm => t(:confirm) %> <%= t('.or') %>
              <%= link_to t('.reject'), '#', :class => 'reject'  %>
            </div>
          </td>
        </tr>
      <% end %>
    </table>

    <table>
      <h2><%= t ".approved" %></h2>
      <% @organizations.select{ |org| org.status == "approved"}.each do |organization|%>
        <tr><td> <%= organization.name %> </td> </tr>
      <% end %>
    </table>

    <table>
      <h2><%= t ".rejected" %></h2>
      <% @organizations.select{ |org| org.status == "rejected"}.each do |organization|%>
        <tr><td> <%= organization.name %> </td> </tr>
      <% end %>
    </table>
  <% end %>
</div>

<script type="text/javascript">
  $(function(){
    $(".reject").click(function(){
      var reject_message = <%= raw("prompt(\"") + t(".reject_prompt_message") + raw("\");")%>
      if(reject_message != null) {
        $("#rejection_message").val(reject_message);
        document.forms[0].submit();
      }
    });
  });
</script>
